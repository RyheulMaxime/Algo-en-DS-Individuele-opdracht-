<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AL&DS Shop — Customer Profile</title>
  <meta name="description" content="AL&DS Shop — premium, responsive product listing" />
  <link rel="icon" type="image/png" sizes="16x16" href="./assets/favicon/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="./assets/favicon/favicon-32x32.png">

  <style>
    :root{
      --bg:#f5f6f7;
      --muted:#777;
      --text:#121214;
      --surface:#ffffff;
      --brand-1:#5337ff;
      --brand-2:#3116c1;
      --card-radius:16px;
      --space-sm:0.5rem;
      --space-md:1rem;
      --space-lg:1.5rem;
      --max-width:1100px;
      --focus: 3px solid rgba(83,55,255,0.16);
      --shadow-sm: 0 2px 10px rgba(0,0,0,0.08);
      --shadow-lg: 0 4px 20px rgba(0,0,0,0.12);
    }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:var(--text);
      line-height:1.35;
    }

    /* Header */
    header.site-header{
      background: linear-gradient(135deg, var(--brand-1), var(--brand-2));
      color: #fff;
      padding: clamp(1.25rem, 3vw, 2.5rem);
      text-align:center;
      box-shadow: var(--shadow-lg);
      position: relative;
    }
    header .brand {
      margin:0;
      font-weight:700;
      letter-spacing:0.6px;
      font-size: clamp(1.25rem, 2.4vw, 2.2rem);
      color: #fff;
      text-decoration: none;
      display: inline-block;
    }
    header .tagline { margin: .35rem 0 0; font-weight:500; color: rgba(255,255,255,0.92); opacity:0.95; font-size: .95rem; }

    .header-actions { position: absolute; right: 1rem; top: 1rem; display:flex; gap:.5rem; align-items:center; }
    .dropbtn { background-color: transparent; color: white; padding: .5rem .8rem; font-size: 0.95rem; border: 1px solid rgba(255,255,255,0.12); border-radius: 10px; cursor: pointer; }
    .dropdown { position: relative; }
    .dropdown-content { display:none; position:absolute; right:0; background-color:#fff; color:#111; min-width:160px; box-shadow: 0 8px 24px rgba(2,6,23,0.12); border-radius: 10px; overflow: hidden; z-index: 30; }
    .dropdown-content a, .dropdown-content button { display:block; width:100%; padding: .6rem 1rem; border: none; background: none; text-align:left; color: inherit; font-size: .95rem; cursor: pointer; }
    .dropdown-content a:hover, .dropdown-content button:hover { background: #f3f4f6; }
    .dropdown.open .dropdown-content{ display:block; }

    /* Customer profile layout */
    main.profile-container { max-width: var(--max-width); margin: 2rem auto; padding: 0 1rem; }
    h1,h2 { margin-top:1rem; }
    .info-block { background: var(--surface); padding: 1.2rem; border-radius: var(--card-radius); box-shadow: var(--shadow-sm); margin-bottom: 1.5rem; }
    .info-block p { margin: 0.25rem 0; }

    /* Buttons */
    .btn { padding:.6rem .85rem; border-radius:8px; border:0; cursor:pointer; font-weight:600; margin-right:.5rem; }
    .btn.primary { background: linear-gradient(180deg,var(--brand-1),var(--brand-2)); color:#fff; }
    .btn.ghost { background: #f3f4f6; color: #111; }

    /* Modals */
    .overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.45); z-index: 60; padding: 1rem; }
    .overlay.open { display:flex; }
    .modal { background: white; border-radius: 12px; padding: 1.25rem; max-width: 420px; width: 100%; box-shadow: 0 10px 30px rgba(2,6,23,0.18); }
    .modal h2{ margin:0 0 .5rem; }
    .modal p{ margin:.25rem 0; color:var(--muted); }
    .modal .actions { margin-top:1rem; display:flex; gap:.5rem; justify-content:flex-end; }
    .visually-hidden{ position:absolute!important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; border:0; padding:0; margin:-1px; }
  
    .order-card {
        background: var(--surface);
        padding: 1rem;
        border-radius: var(--card-radius);
        box-shadow: var(--shadow-sm);
        margin-bottom: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }
    .order-card p { margin: 0; }
    .order-card button { align-self: flex-start; margin-top: 0.5rem; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header" role="banner">
    <a class="brand" href="/" aria-label="Go to homepage">AL&amp;DS Shop</a>
    <p class="tagline">Curated products — clean design, delightful shopping</p>
    <div class="header-actions" aria-hidden="false">
      <div id="user-dropdown" class="dropdown" aria-haspopup="true">
        {% if customer %}
          <button id="user-button" class="dropbtn" aria-expanded="false">{{ customer.customername }}</button>
          <div class="dropdown-content" role="menu" aria-label="User menu">
            <a role="menuitem" href="/customer">Customer Profile</a>
            <a role="menuitem" href="/logout">Logout</a>
          </div>
        {% else %}
          <button id="user-button" class="dropbtn" aria-expanded="false">Account</button>
          <div class="dropdown-content" role="menu" aria-label="Account menu">
            <a role="menuitem" href="/login">Login</a>
            <a role="menuitem" href="/register">Register</a>
          </div>
        {% endif %}
      </div>
    </div>
  </header>

  <!-- Customer Profile -->
  {% if customer %}
  <main class="profile-container">
    <h1>Logged in as {{ customer.customername }}</h1>

    <div class="info-block">
      <h2>Customer Info</h2>
      <p>Name: {{ customer.customername }}</p>
      <p>Contact: {{ customer.contactname }}</p>
      <p>Address: {{ customer.address }}</p>
      <p>Postal Code: {{ customer.postalcode }}</p>
      <p>City: {{ customer.city }}</p>
      <p>Country: {{ customer.country }}</p>
      <button class="btn primary" id="edit-info-btn">Edit Info</button>
      <button class="btn ghost" id="change-password-btn">Change Password</button>
    </div>

   {% if orders %}
        <div class="info-block">
        <h2>Orders</h2>
        {% for key, value in orders.items() %}
            <div class="order-card" id="order-{{ key }}" data-orderid="{{ key }}" data-productid="{{ value.productid }}">
                <p><strong>Product:</strong> {{ value.productname }}</p>
                <p><strong>Unit Price:</strong> {{ value.unitprice }}</p>
                <p><strong>Quantity:</strong> {{ value.quantity }}</p>
                <p><strong>Order Placed on:</strong> {{ value.createdat }}</p>
                <form action="/customer/delete/{{ key }}" method="POST" style="display:inline;">
                    <button type="submit" class="btn ghost delete-order">Delete</button>
                </form>
            </div>
        {% endfor %}
        </div>
        {% endif %}
  </main>

  <!-- Edit Info Modal -->
  <div id="edit-info-overlay" class="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <h2>Edit Customer Info</h2>
      <form action="/customer/edit" method="post">
        <label for="new_name">Name</label>
        <input type="text" name="new_name" required value="{{ customer.customername }}"/>
        <label for="new_contact">Contact</label>
        <input type="text" name="new_contact" value="{{ customer.contactname }}"/>
        <label for="new_address">Address</label>
        <input type="text" name="new_address" value="{{ customer.address }}"/>
        <label for="new_postalcode">Postal Code</label>
        <input type="text" name="new_postalcode" value="{{ customer.postalcode }}"/>
        <label for="new_city">City</label>
        <input type="text" name="new_city" value="{{ customer.city }}" />
        <label for="new_country">Country</label>
        <input type="text" name="new_country" value="{{ customer.country }}" />
        <div class="actions">
          <button type="button" class="btn ghost" id="edit-info-cancel">Cancel</button>
          <button type="submit" class="btn primary">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div id="change-password-overlay" class="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <h2>Change Password</h2>
      <form action="/customer/reset" method="post">
        <label for="previous_password">Previous Password</label>
        <input type="password" name="previous_password"/>
        <label for="new_password">New Password</label>
        <input type="password" name="new_password"/>
        <div class="actions">
          <button type="button" class="btn ghost" id="change-password-cancel">Cancel</button>
          <button type="submit" class="btn primary">Change</button>
        </div>
      </form>
    </div>
  </div>
  {% else %}
  <main class="profile-container">
    <h1>Not logged in</h1>
  </main>
  {% endif %}

  <script>
    // Dropdown toggle
    const userDropdown = document.getElementById('user-dropdown');
    const userButton = document.getElementById('user-button');
    if(userButton && userDropdown){
      userButton.addEventListener('click', ()=>{
        userDropdown.classList.toggle('open');
        const expanded = userButton.getAttribute('aria-expanded') === 'true';
        userButton.setAttribute('aria-expanded', String(!expanded));
      });
      document.addEventListener('click', (e)=>{
        if(!userDropdown.contains(e.target)){
          userDropdown.classList.remove('open');
          userButton.setAttribute('aria-expanded','false');
        }
      });
    }

    // Modals
    const editInfoBtn = document.getElementById('edit-info-btn');
    const changePasswordBtn = document.getElementById('change-password-btn');
    const editInfoOverlay = document.getElementById('edit-info-overlay');
    const changePasswordOverlay = document.getElementById('change-password-overlay');
    const editInfoCancel = document.getElementById('edit-info-cancel');
    const changePasswordCancel = document.getElementById('change-password-cancel');

    function openModal(el){ if(el){ el.classList.add('open'); el.setAttribute('aria-hidden','false'); } }
    function closeModal(el){ if(el){ el.classList.remove('open'); el.setAttribute('aria-hidden','true'); } }

    if(editInfoBtn) editInfoBtn.addEventListener('click', ()=>openModal(editInfoOverlay));
    if(changePasswordBtn) changePasswordBtn.addEventListener('click', ()=>openModal(changePasswordOverlay));
    if(editInfoCancel) editInfoCancel.addEventListener('click', ()=>closeModal(editInfoOverlay));
    if(changePasswordCancel) changePasswordCancel.addEventListener('click', ()=>closeModal(changePasswordOverlay));
    document.addEventListener('keydown',(e)=>{
      if(e.key==='Escape'){ closeModal(editInfoOverlay); closeModal(changePasswordOverlay);}
    });
  </script>
</body>
</html>
