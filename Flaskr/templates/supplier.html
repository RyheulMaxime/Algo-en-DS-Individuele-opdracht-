<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AL&DS Shop — Supplier</title>

  <!-- MapLibre -->
    <script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css" rel="stylesheet" />

    <style>
        :root{
        --bg:#f5f6f7;
        --muted:#777;
        --text:#121214;
        --surface:#ffffff;
        --brand-1:#5337ff;
        --brand-2:#3116c1;
        --card-radius:16px;
        --shadow-sm: 0 2px 10px rgba(0,0,0,0.08);
        --shadow-lg: 0 4px 20px rgba(0,0,0,0.12);
        --max-width:1100px;
        }
        *{box-sizing:border-box}
        html,body{height:100%}
        body{
        margin:0;
        font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        background:var(--bg);
        color:var(--text);
        line-height:1.35;
        }

        header.site-header{
        background: linear-gradient(135deg, var(--brand-1), var(--brand-2));
        color: #fff;
        padding: clamp(1rem, 3vw, 1.8rem);
        text-align:center;
        box-shadow: var(--shadow-lg);
        }
        header .brand {
        margin:0;
        font-weight:700;
        letter-spacing:0.6px;
        font-size: clamp(1.1rem, 2.2vw, 1.9rem);
        text-decoration: none;
        color: #fff;
        display:inline-block;
        }

        main.page {
        max-width: var(--max-width);
        margin: 1.5rem auto;
        padding: 0 1rem 3rem;
        }

        .container {
        display: grid;
        grid-template-columns: 1fr 380px;
        gap: 1.7rem;
        }
        @media (max-width: 900px){
        .container{ grid-template-columns: 1fr; }
        .map-wrapper{ order: 3; }
        }

        .card {
        background: var(--surface);
        border-radius: var(--card-radius);
        padding: 1.4rem;
        box-shadow: var(--shadow-sm);
        }

        .supplier-title {
        margin: 0 0 .5rem;
        font-size: 1.6rem;
        font-weight:700;
        }

        .map-wrapper { border-radius: var(--card-radius); overflow:hidden; box-shadow: var(--shadow-sm); }
        #map { width:100%; height: 420px; min-height:260px; }

        .product-list {
        display:grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap:1rem;
        margin-top: 1rem;
        }
        .product {
        background: var(--surface);
        border-radius: 12px;
        padding: .9rem;
        box-shadow: var(--shadow-sm);
        display:flex;
        flex-direction:column;
        gap:.35rem;
        text-decoration:none;
        color:inherit;
        transition: transform .18s ease, box-shadow .18s ease;
        }
        .product:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
        }
    </style>
</head>

<body>
    <header class="site-header">
    <a class="brand" href="/">AL&amp;DS Shop</a>
    <p class="tagline">Curated products — clean design, delightful shopping</p>
    </header>

<main class="page">
    {% if supplier %}
        <div class="container">

            <!-- Hidden dataset container -->
            <div id="supplier-data"
                data-id="{{ supplier.supplierid }}"
                data-name="{{ supplier.suppliername }}"
                data-lat="{{ supplier.latitude }}"
                data-lon="{{ supplier.longitude }}">
            </div>

            <!-- left column -->
            <section class="card">
            <h1 class="supplier-title">{{ supplier.suppliername }}</h1>

            <p><strong>Contact:</strong> {{ supplier.contactname }}</p>
            <p><strong>Address:</strong> {{ supplier.address }}</p>
            <p>{{ supplier.postalcode }} {{ supplier.city }}, {{ supplier.country }}</p>

            <h2 style="margin-top:1rem;">Products from this supplier</h2>

            <div class="product-list">
                {% for product in products %}
                <a class="product"
                    href="/product?id={{ product.productid }}"
                    data-id="{{ product.productid }}"
                    data-supplier="{{ product.supplierid }}">
                    <p class="title">{{ product.productname }}</p>
                    <p class="meta">{{ product.unit }}</p>
                    <p class="price">${{ '%.2f'|format(product.price) }}</p>
                </a>
                {% endfor %}
            </div>
            </section>

            <!-- right column -->
            <aside class="map-wrapper">
            <div id="map"></div>
            </aside>

        </div>
    {% else %}
        <div class="card"><h2>Supplier not found</h2></div>
    {% endif %}
</main>

<script>
    (function(){

    /** Extract supplier data from HTML data attributes */
    const el = document.getElementById("supplier-data");
    if (!el) return;

    const supplierId   = el.dataset.id;
    const supplierName = el.dataset.name;
    const lat          = Number(el.dataset.lat);
    const lon          = Number(el.dataset.lon);
    console.log(supplierId, supplierName, lat, lon);

    /** Validate coordinates */
    const valid = Number.isFinite(lat) && Number.isFinite(lon);

    if (!valid) {
        document.getElementById("map").innerHTML =
        '<div style="padding:1rem;color:#666">Location not available.</div>';
        return;
    }

    /** Initialize MapLibre */
    const map = new maplibregl.Map({
        style: 'https://tiles.openfreemap.org/styles/liberty',
        center: [lon, lat],
        zoom: 12,
        container: 'map'
    });

    map.addControl(new maplibregl.NavigationControl({ showCompass:false }), 'top-left');

    /** Create marker */
    const markerEl = document.createElement("div");
    markerEl.style.width = "20px";
    markerEl.style.height = "20px";
    markerEl.style.borderRadius = "50%";
    markerEl.style.background = "linear-gradient(180deg,#5337ff,#3116c1)";
    markerEl.style.boxShadow = "0 2px 6px rgba(0,0,0,0.3)";
    markerEl.style.border = "2px solid #fff";

    /** Create popup safely */
    const popupContent = document.createElement("div");

    const title = document.createElement("strong");
    title.textContent = supplierName;
    popupContent.appendChild(title);

    popupContent.appendChild(document.createElement("br"));

    const link = document.createElement("a");
    link.href = "/supplier?id=" + encodeURIComponent(supplierId);
    link.textContent = "View supplier";
    popupContent.appendChild(link);

    const popup = new maplibregl.Popup({ offset: 12 }).setDOMContent(popupContent);

    new maplibregl.Marker(markerEl)
        .setLngLat([lon, lat])
        .setPopup(popup)
        .addTo(map);

    popup.addTo(map);

})();
</script>

</body>
</html>
